(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["edit-product"],{"0d1e":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"repease-product"},[r("h2",{staticClass:"title"},[e._v(e._s(e.title))]),r("BaseInfo",{attrs:{editInfo:e.editInfo},on:{update:e.update}}),r("div",{staticClass:"btn-wrap"},[r("el-button",{attrs:{type:""},on:{click:e.cancel}},[e._v("取消编辑")]),r("el-button",{attrs:{type:"primary"},on:{click:e.vertify}},[e._v("保存并预览")])],1)],1)},a=[],i=(r("a623"),r("caad"),r("d81d"),r("2532"),r("96cf"),r("1da1")),o=r("5530"),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"base-info"},[r("h3",{staticClass:"item-title"},[e._v("任务信息")]),r("el-form",{ref:"baseForm",staticClass:"base-form",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.info,rules:e.rules}},[r("el-form-item",{attrs:{label:"任务名称",prop:"task_name"}},[r("el-input",{staticClass:"medium",attrs:{placeholder:"请输入任务名称"},model:{value:e.info.task_name,callback:function(t){e.$set(e.info,"task_name",t)},expression:"info.task_name"}})],1),r("el-form-item",{attrs:{label:"任务描述",prop:"task_desc"}},[r("el-input",{staticClass:"medium",attrs:{type:"textarea",placeholder:"请输入任务描述"},model:{value:e.info.task_desc,callback:function(t){e.$set(e.info,"task_desc",t)},expression:"info.task_desc"}})],1),r("el-form-item",{attrs:{label:"任务主图",prop:"main_image"}},[r("el-upload",{attrs:{action:"#","file-list":e.info.main_image,limit:1,"on-change":e.mainHandleChange,"auto-upload":!1,"list-type":"picture-card","http-request":e.uploadImg},scopedSlots:e._u([{key:"file",fn:function(t){var n=t.file;return r("div",{},[r("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:n.url,alt:""}}),r("span",{staticClass:"el-upload-list__item-actions"},[r("span",{staticClass:"el-upload-list__item-preview",on:{click:function(t){return e.handlePictureCardPreview(n)}}},[r("i",{staticClass:"el-icon-zoom-in"})]),e.disabled?e._e():r("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleDownload(n)}}},[r("i",{staticClass:"el-icon-download"})]),e.disabled?e._e():r("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleRemove(n,"main_image")}}},[r("i",{staticClass:"el-icon-delete"})])])])}}])},[r("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),r("el-form-item",{attrs:{label:"任务时间",prop:"day_num"}},[r("el-input",{staticClass:"medium",attrs:{placeholder:"请输入任务时间，按照天计算"},model:{value:e.info.day_num,callback:function(t){e.$set(e.info,"day_num",t)},expression:"info.day_num"}})],1),r("el-form-item",{attrs:{label:"任务最大押金",prop:"max_amount"}},[r("el-input",{staticClass:"medium",attrs:{placeholder:"请输入正整数"},model:{value:e.info.max_amount,callback:function(t){e.$set(e.info,"max_amount",t)},expression:"info.max_amount"}},[r("template",{slot:"prepend"},[e._v("¥")])],2)],1),r("el-form-item",{attrs:{label:"任务最小押金",prop:"min_amount"}},[r("el-input",{staticClass:"medium",attrs:{placeholder:"请输入正整数"},model:{value:e.info.min_amount,callback:function(t){e.$set(e.info,"min_amount",t)},expression:"info.min_amount"}},[r("template",{slot:"prepend"},[e._v("¥")])],2)],1),r("el-form-item",{attrs:{label:"任务回报率",prop:"reward_rate"}},[r("el-input",{staticClass:"medium",model:{value:e.info.reward_rate,callback:function(t){e.$set(e.info,"reward_rate",t)},expression:"info.reward_rate"}}),r("el-select",{staticStyle:{"margin-left":"10px"},attrs:{placeholder:"请选择奖金计算规则"},model:{value:e.info.task_type,callback:function(t){e.$set(e.info,"task_type",t)},expression:"info.task_type"}},e._l(e.rewardList,(function(e){return r("el-option",{key:e.val,attrs:{label:e.name,value:e.val}})})),1)],1),r("el-form-item",{attrs:{label:"任务排序",prop:"seq"}},[r("el-input",{staticClass:"medium",model:{value:e.info.seq,callback:function(t){e.$set(e.info,"seq",t)},expression:"info.seq"}})],1)],1),r("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},u=[],c=(r("4de4"),r("2f7f")),l={name:"base-info",props:{editInfo:Object},data:function(){return{labelPosition:"right",info:{task_name:"",task_desc:"",main_image:[],day_num:"",max_amount:"",reward_rate:50,min_amount:"",seq:0,task_type:1},main_image:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,rewardList:[{name:"百分比",val:"1"},{name:"固定金额",val:"2"}]}},methods:{onSubmit:function(){console.log("submit!")},handleRemove:function(e,t){var r=this.info[t];this.info[t]=r.filter((function(t){return t.uid!==e.uid}))},handleChange:function(e,t){this.info.gallery_image=t},mainHandleChange:function(e){this.info.main_image=[e],this.cutImg(e)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeUpload:function(){return!1},uploadImg:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.image,r.prev=1,r.next=4,Object(c["i"])({file_base_64:n});case 4:a=r.sent,i=a.errorCode,o=a.data,0===i?e.requestUrls=o:(t.info.main_image=[],t.$message.error("图片上传失败，请重新上传")),r.next=15;break;case 10:r.prev=10,r.t0=r["catch"](1),console.log("err"),t.info.main_image=[],t.$message.error("图片上传失败，请重新上传");case 15:case"end":return r.stop()}}),r,null,[[1,10]])})))()},cutImg:function(e){var t=this,r=document.createElement("img");r.style.position="absolute",r.style.left="-300000px",r.src=e.url,r.addEventListener("load",(function(){var n=r.width,a=r.height;t.drawImg(r,n,a,e)}))},drawImg:function(e,t,r,n){var a=document.createElement("canvas");a.width=t,a.height=r;var i=a.getContext("2d");i.drawImage(e,0,0,e.width,e.height,0,0,t,r),n.image=a.toDataURL("image/jpeg",.71),this.uploadImg(n)},initInfo:function(){var e=window.sessionStorage.getItem("$editInfo");if(!e)return!1;var t=JSON.parse(e),r={main_image:[]},n=["task_name","task_desc","task_status","day_num","reward_rate","seq","task_type"];n.map((function(e){r[e]=t[e]})),r.main_image=[{url:t.task_cover,file:"task_cover"}],r.task_id=t.id,r.max_amount=parseInt(t.display_max_amount),r.min_amount=parseInt(t.display_min_amount),this.info=r},checkForm:function(){console.log("this",this)}},watch:{info:{deep:!0,handler:function(e){this.$emit("update","baseInfo",e)}},editInfo:{deep:!0,handler:function(){this.initInfo()}}},computed:{isEdit:function(){return/edit-product/.test(this.$route.path)},rules:function(){return{task_name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],task_desc:[{required:!0,message:"请输入任务描述",trigger:"blur"}],task_type:[{required:!0,message:"请选择鲜花类型",trigger:"blur"}],main_image:[{required:!0,message:"请上传任务图片",trigger:"blur"}],day_num:[{required:!0,message:"请输入任务时间周期",trigger:"blur"}],shipping_price:[{required:!0,message:"请输入商品运费",trigger:"blur"}],max_amount:[{required:!0,message:"请输入押金最大金额",trigger:"blur"}],min_amount:[{required:!0,message:"请输入押金最小金额",trigger:"blur"}],seq:[{required:!0,message:"请输入库存",trigger:"blur"}],reward_rate:[{required:!0,message:"请输入奖金回报率",trigger:"blur"}]}}},created:function(){this.isEdit&&this.initInfo()},mounted:function(){this.$emit("update","baseForm",this.$refs.baseForm)}},d=l,f=(r("b31f"),r("2877")),m=Object(f["a"])(d,s,u,!1,null,"3fd705a0",null),p=m.exports,g={name:"repease-product",props:{},components:{BaseInfo:p},data:function(){return{labelPosition:"right",baseInfo:{main_image:[]},baseForm:null,editInfo:null,info:{},loading:!1}},computed:{title:function(){return this.$route.meta.title},isEdit:function(){return/edit-task/.test(this.$route.path)},rules:function(){return{}}},watch:{$route:function(){this.loadInfo()}},mounted:function(){window.sessionStorage.removeItem("$eitdInfo"),this.isEdit&&this.loadInfo()},methods:{update:function(e,t){this[e]=t},vertify:function(){var e=this;this.baseForm.validate((function(t){if(!t)return console.log("error submit!!"),!1;e.submit()}))},cancel:function(){this.$router.go(-1)},vertifySpecialForm:function(){var e=this;this.baseForm.validate((function(t){if(!t)return console.log("error submit!!"),!1;e.submit()}))},submit:function(){var e=this.baseInfo,t=e.main_image,r=Object(o["a"])(Object(o["a"])({},e),{},{task_cover:this.getImgSrc(t)[0].content});delete r.main_image;var n=[],a=n.every((function(e){return e&&!e.includes("blob:")}));return a?this.isEdit?(this.updateProductInfo(r),!1):void this.createProductInfo(r):(this.$message.error("图片上传中，请稍后再试"),!1)},updateProductInfo:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.loading){r.next=2;break}return r.abrupt("return",!1);case 2:return t.loading=!0,r.next=5,Object(c["h"])(e);case 5:n=r.sent,a=n.errorCode,t.loading=!1,0===a&&t.$router.go(-1);case 9:case"end":return r.stop()}}),r)})))()},createProductInfo:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.loading){r.next=2;break}return r.abrupt("return",!1);case 2:return t.loading=!0,r.next=5,Object(c["a"])(e);case 5:n=r.sent,a=n.errorCode,t.loading=!1,0===a&&t.$router.go(-1);case 9:case"end":return r.stop()}}),r)})))()},getImgSrc:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length?e.map((function(e,t){var r={id:t,type:"image"};return e.requestUrls?r.content=e.requestUrls:r.content=e.url,r})):""},loadInfo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["f"])(e.$route.query);case 2:r=t.sent,n=r.errorCode,a=r.data,0===n&&(e.editInfo=a,window.sessionStorage.setItem("$editInfo",JSON.stringify(a)));case 6:case"end":return t.stop()}}),t)})))()}}},b=g,h=(r("92d0"),Object(f["a"])(b,n,a,!1,null,"1b9ba4e3",null));t["default"]=h.exports},"159b":function(e,t,r){var n=r("da84"),a=r("fdbc"),i=r("17c2"),o=r("9112");for(var s in a){var u=n[s],c=u&&u.prototype;if(c&&c.forEach!==i)try{o(c,"forEach",i)}catch(l){c.forEach=i}}},"17c2":function(e,t,r){"use strict";var n=r("b727").forEach,a=r("a640"),i=r("ae40"),o=a("forEach"),s=i("forEach");e.exports=o&&s?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},2532:function(e,t,r){"use strict";var n=r("23e7"),a=r("5a34"),i=r("1d80"),o=r("ab13");n({target:"String",proto:!0,forced:!o("includes")},{includes:function(e){return!!~String(i(this)).indexOf(a(e),arguments.length>1?arguments[1]:void 0)}})},4160:function(e,t,r){"use strict";var n=r("23e7"),a=r("17c2");n({target:"Array",proto:!0,forced:[].forEach!=a},{forEach:a})},"44e7":function(e,t,r){var n=r("861d"),a=r("c6b6"),i=r("b622"),o=i("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==a(e))}},"4db0":function(e,t,r){},"4de4":function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").filter,i=r("1dde"),o=r("ae40"),s=i("filter"),u=o("filter");n({target:"Array",proto:!0,forced:!s||!u},{filter:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},5530:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("a4d3"),r("4de4"),r("4160"),r("e439"),r("dbb4"),r("b64b"),r("159b");function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}},"5a34":function(e,t,r){var n=r("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},"92d0":function(e,t,r){"use strict";var n=r("dca8"),a=r.n(n);a.a},a623:function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").every,i=r("a640"),o=r("ae40"),s=i("every"),u=o("every");n({target:"Array",proto:!0,forced:!s||!u},{every:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},a640:function(e,t,r){"use strict";var n=r("d039");e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},ab13:function(e,t,r){var n=r("b622"),a=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[a]=!1,"/./"[e](t)}catch(n){}}return!1}},b31f:function(e,t,r){"use strict";var n=r("4db0"),a=r.n(n);a.a},b64b:function(e,t,r){var n=r("23e7"),a=r("7b0b"),i=r("df75"),o=r("d039"),s=o((function(){i(1)}));n({target:"Object",stat:!0,forced:s},{keys:function(e){return i(a(e))}})},d81d:function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").map,i=r("1dde"),o=r("ae40"),s=i("map"),u=o("map");n({target:"Array",proto:!0,forced:!s||!u},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},dbb4:function(e,t,r){var n=r("23e7"),a=r("83ab"),i=r("56ef"),o=r("fc6a"),s=r("06cf"),u=r("8418");n({target:"Object",stat:!0,sham:!a},{getOwnPropertyDescriptors:function(e){var t,r,n=o(e),a=s.f,c=i(n),l={},d=0;while(c.length>d)r=a(n,t=c[d++]),void 0!==r&&u(l,t,r);return l}})},dca8:function(e,t,r){},e439:function(e,t,r){var n=r("23e7"),a=r("d039"),i=r("fc6a"),o=r("06cf").f,s=r("83ab"),u=a((function(){o(1)})),c=!s||u;n({target:"Object",stat:!0,forced:c,sham:!s},{getOwnPropertyDescriptor:function(e,t){return o(i(e),t)}})}}]);
//# sourceMappingURL=edit-product.a6b75d14.js.map