(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["edit-product"],{"0d1e":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"repease-product"},[n("h2",{staticClass:"title"},[e._v(e._s(e.title))]),n("BaseInfo",{attrs:{editInfo:e.editInfo},on:{update:e.update}}),n("div",{staticClass:"btn-wrap"},[n("el-button",{attrs:{type:""},on:{click:e.cancel}},[e._v("取消编辑")]),n("el-button",{attrs:{type:"primary"},on:{click:e.vertify}},[e._v("保存并预览")])],1)],1)},i=[],a=(n("a623"),n("caad"),n("d81d"),n("2532"),n("96cf"),n("1da1")),o=n("5530"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"base-info"},[n("h3",{staticClass:"item-title"},[e._v("任务信息")]),n("el-form",{ref:"baseForm",staticClass:"base-form",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.info,rules:e.rules}},[n("el-form-item",{attrs:{label:"任务名称",prop:"task_name"}},[n("el-input",{staticClass:"medium",attrs:{placeholder:"请输入任务名称"},model:{value:e.info.task_name,callback:function(t){e.$set(e.info,"task_name",t)},expression:"info.task_name"}})],1),n("el-form-item",{attrs:{label:"任务描述",prop:"task_desc"}},[n("el-input",{staticClass:"medium",attrs:{type:"textarea",placeholder:"请输入任务描述"},model:{value:e.info.task_desc,callback:function(t){e.$set(e.info,"task_desc",t)},expression:"info.task_desc"}})],1),n("el-form-item",{attrs:{label:"任务主图",prop:"main_image"}},[n("el-upload",{attrs:{action:"#","file-list":e.info.main_image,limit:1,"on-change":e.mainHandleChange,"auto-upload":!1,"list-type":"picture-card","http-request":e.uploadImg},scopedSlots:e._u([{key:"file",fn:function(t){var r=t.file;return n("div",{},[n("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:r.url,alt:""}}),n("span",{staticClass:"el-upload-list__item-actions"},[n("span",{staticClass:"el-upload-list__item-preview",on:{click:function(t){return e.handlePictureCardPreview(r)}}},[n("i",{staticClass:"el-icon-zoom-in"})]),e.disabled?e._e():n("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleDownload(r)}}},[n("i",{staticClass:"el-icon-download"})]),e.disabled?e._e():n("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleRemove(r,"main_image")}}},[n("i",{staticClass:"el-icon-delete"})])])])}}])},[n("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1),n("el-form-item",{attrs:{label:"任务时间",prop:"day_num"}},[n("el-input",{staticClass:"medium",attrs:{placeholder:"请输入任务时间，按照天计算"},model:{value:e.info.day_num,callback:function(t){e.$set(e.info,"day_num",t)},expression:"info.day_num"}})],1),n("el-form-item",{attrs:{label:"任务最大押金",prop:"max_amount"}},[n("el-input",{staticClass:"medium",attrs:{placeholder:"请输入正整数"},model:{value:e.info.max_amount,callback:function(t){e.$set(e.info,"max_amount",t)},expression:"info.max_amount"}},[n("template",{slot:"prepend"},[e._v("¥")])],2)],1),n("el-form-item",{attrs:{label:"任务最小押金",prop:"min_amount"}},[n("el-input",{staticClass:"medium",attrs:{placeholder:"请输入正整数"},model:{value:e.info.min_amount,callback:function(t){e.$set(e.info,"min_amount",t)},expression:"info.min_amount"}},[n("template",{slot:"prepend"},[e._v("¥")])],2)],1),n("el-form-item",{attrs:{label:"任务回报率",prop:"reward_rate"}},[n("el-input",{staticClass:"medium",model:{value:e.info.reward_rate,callback:function(t){e.$set(e.info,"reward_rate",t)},expression:"info.reward_rate"}}),n("el-select",{staticStyle:{"margin-left":"10px"},attrs:{placeholder:"请选择奖金计算规则"},model:{value:e.info.task_type,callback:function(t){e.$set(e.info,"task_type",t)},expression:"info.task_type"}},e._l(e.rewardList,(function(e){return n("el-option",{key:e.val,attrs:{label:e.name,value:e.val}})})),1)],1),n("el-form-item",{attrs:{label:"任务排序",prop:"seq"}},[n("el-input",{staticClass:"medium",model:{value:e.info.seq,callback:function(t){e.$set(e.info,"seq",t)},expression:"info.seq"}})],1)],1),n("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},l=[],u=(n("4de4"),n("b0c0"),n("ac1f"),n("1276"),n("2f7f")),c={name:"base-info",props:{editInfo:Object},data:function(){return{labelPosition:"right",info:{task_name:"",task_desc:"",main_image:[],day_num:"",max_amount:"",reward_rate:50,min_amount:"",seq:0,task_type:1},main_image:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,rewardList:[{name:"百分比",val:1},{name:"固定金额",val:0}]}},methods:{onSubmit:function(){console.log("submit!")},handleRemove:function(e,t){var n=this.info[t];this.info[t]=n.filter((function(t){return t.uid!==e.uid}))},handleChange:function(e,t){this.info.gallery_image=t},mainHandleChange:function(e){this.info.main_image=[e],this.cutImg(e)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeUpload:function(){return!1},uploadImg:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i,a,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.image,n.prev=1,n.next=4,Object(u["i"])({file_base_64:r});case 4:i=n.sent,a=i.errorCode,o=i.data,0===a?e.requestUrls=o:(t.info.main_image=[],t.$message.error("图片上传失败，请重新上传")),n.next=15;break;case 10:n.prev=10,n.t0=n["catch"](1),console.log("err"),t.info.main_image=[],t.$message.error("图片上传失败，请重新上传");case 15:case"end":return n.stop()}}),n,null,[[1,10]])})))()},cutImg:function(e){var t=this,n=document.createElement("img");n.style.position="absolute",n.style.left="-300000px",n.src=e.url,n.addEventListener("load",(function(){var r=n.width,i=n.height;t.drawImg(n,r,i,e)}))},drawImg:function(e,t,n,r){var i=document.createElement("canvas");i.width=t,i.height=n;var a=i.getContext("2d");a.drawImage(e,0,0,e.width,e.height,0,0,t,n);var o=r.name.split(".").pop();r.image=i.toDataURL("image/".concat(o),.71),this.uploadImg(r)},initInfo:function(){var e=window.sessionStorage.getItem("$editInfo");if(!e)return!1;var t=JSON.parse(e),n={main_image:[]},r=["task_name","task_desc","task_status","day_num","reward_rate","seq","task_type"];r.map((function(e){n[e]=t[e]})),n.main_image=[{url:t.task_cover,file:"task_cover"}],n.task_id=t.id,n.max_amount=parseInt(t.display_max_amount),n.min_amount=parseInt(t.display_min_amount),this.info=n},checkForm:function(){console.log("this",this)}},watch:{info:{deep:!0,handler:function(e){this.$emit("update","baseInfo",e)}},editInfo:{deep:!0,handler:function(){this.initInfo()}}},computed:{isEdit:function(){return/edit-product/.test(this.$route.path)},rules:function(){return{task_name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],task_desc:[{required:!0,message:"请输入任务描述",trigger:"blur"}],task_type:[{required:!0,message:"请选择鲜花类型",trigger:"blur"}],main_image:[{required:!0,message:"请上传任务图片",trigger:"blur"}],day_num:[{required:!0,message:"请输入任务时间周期",trigger:"blur"}],shipping_price:[{required:!0,message:"请输入商品运费",trigger:"blur"}],max_amount:[{required:!0,message:"请输入押金最大金额",trigger:"blur"}],min_amount:[{required:!0,message:"请输入押金最小金额",trigger:"blur"}],seq:[{required:!0,message:"请输入库存",trigger:"blur"}],reward_rate:[{required:!0,message:"请输入奖金回报率",trigger:"blur"}]}}},created:function(){this.isEdit&&this.initInfo()},mounted:function(){this.$emit("update","baseForm",this.$refs.baseForm)}},d=c,f=(n("fb84"),n("2877")),m=Object(f["a"])(d,s,l,!1,null,"2b0c8034",null),p=m.exports,g={name:"repease-product",props:{},components:{BaseInfo:p},data:function(){return{labelPosition:"right",baseInfo:{main_image:[]},baseForm:null,editInfo:null,info:{},loading:!1}},computed:{title:function(){return this.$route.meta.title},isEdit:function(){return/edit-task/.test(this.$route.path)},rules:function(){return{}}},watch:{$route:function(){this.loadInfo()}},mounted:function(){window.sessionStorage.removeItem("$eitdInfo"),this.isEdit&&this.loadInfo()},methods:{update:function(e,t){this[e]=t},vertify:function(){var e=this;this.baseForm.validate((function(t){if(!t)return console.log("error submit!!"),!1;e.submit()}))},cancel:function(){this.$router.go(-1)},vertifySpecialForm:function(){var e=this;this.baseForm.validate((function(t){if(!t)return console.log("error submit!!"),!1;e.submit()}))},submit:function(){var e=this.baseInfo,t=e.main_image,n=Object(o["a"])(Object(o["a"])({},e),{},{task_cover:this.getImgSrc(t)[0].content});delete n.main_image;var r=[],i=r.every((function(e){return e&&!e.includes("blob:")}));return i?this.isEdit?(this.updateProductInfo(n),!1):void this.createProductInfo(n):(this.$message.error("图片上传中，请稍后再试"),!1)},updateProductInfo:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.loading){n.next=2;break}return n.abrupt("return",!1);case 2:return t.loading=!0,n.next=5,Object(u["h"])(e);case 5:r=n.sent,i=r.errorCode,t.loading=!1,0===i&&t.$router.go(-1);case 9:case"end":return n.stop()}}),n)})))()},createProductInfo:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.loading){n.next=2;break}return n.abrupt("return",!1);case 2:return t.loading=!0,n.next=5,Object(u["a"])(e);case 5:r=n.sent,i=r.errorCode,t.loading=!1,0===i&&t.$router.go(-1);case 9:case"end":return n.stop()}}),n)})))()},getImgSrc:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length?e.map((function(e,t){var n={id:t,type:"image"};return e.requestUrls?n.content=e.requestUrls:n.content=e.url,n})):""},loadInfo:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["f"])(e.$route.query);case 2:n=t.sent,r=n.errorCode,i=n.data,0===r&&(e.editInfo=i,window.sessionStorage.setItem("$editInfo",JSON.stringify(i)));case 6:case"end":return t.stop()}}),t)})))()}}},h=g,b=(n("92d0"),Object(f["a"])(h,r,i,!1,null,"1b9ba4e3",null));t["default"]=b.exports},1276:function(e,t,n){"use strict";var r=n("d784"),i=n("44e7"),a=n("825a"),o=n("1d80"),s=n("4840"),l=n("8aa5"),u=n("50c4"),c=n("14c3"),d=n("9263"),f=n("d039"),m=[].push,p=Math.min,g=4294967295,h=!f((function(){return!RegExp(g,"y")}));r("split",2,(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(o(this)),a=void 0===n?g:n>>>0;if(0===a)return[];if(void 0===e)return[r];if(!i(e))return t.call(r,e,a);var s,l,u,c=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,h=new RegExp(e.source,f+"g");while(s=d.call(h,r)){if(l=h.lastIndex,l>p&&(c.push(r.slice(p,s.index)),s.length>1&&s.index<r.length&&m.apply(c,s.slice(1)),u=s[0].length,p=l,c.length>=a))break;h.lastIndex===s.index&&h.lastIndex++}return p===r.length?!u&&h.test("")||c.push(""):c.push(r.slice(p)),c.length>a?c.slice(0,a):c}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=o(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var d=a(e),f=String(this),m=s(d,RegExp),b=d.unicode,v=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(h?"y":"g"),_=new m(h?d:"^(?:"+d.source+")",v),y=void 0===i?g:i>>>0;if(0===y)return[];if(0===f.length)return null===c(_,f)?[f]:[];var w=0,k=0,x=[];while(k<f.length){_.lastIndex=h?k:0;var I,O=c(_,h?f:f.slice(k));if(null===O||(I=p(u(_.lastIndex+(h?0:k)),f.length))===w)k=l(f,k,b);else{if(x.push(f.slice(w,k)),x.length===y)return x;for(var C=1;C<=O.length-1;C++)if(x.push(O[C]),x.length===y)return x;k=w=I}}return x.push(f.slice(w)),x}]}),!h)},"159b":function(e,t,n){var r=n("da84"),i=n("fdbc"),a=n("17c2"),o=n("9112");for(var s in i){var l=r[s],u=l&&l.prototype;if(u&&u.forEach!==a)try{o(u,"forEach",a)}catch(c){u.forEach=a}}},"17c2":function(e,t,n){"use strict";var r=n("b727").forEach,i=n("a640"),a=n("ae40"),o=i("forEach"),s=a("forEach");e.exports=o&&s?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},2532:function(e,t,n){"use strict";var r=n("23e7"),i=n("5a34"),a=n("1d80"),o=n("ab13");r({target:"String",proto:!0,forced:!o("includes")},{includes:function(e){return!!~String(a(this)).indexOf(i(e),arguments.length>1?arguments[1]:void 0)}})},"40a8":function(e,t,n){},4160:function(e,t,n){"use strict";var r=n("23e7"),i=n("17c2");r({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},"44e7":function(e,t,n){var r=n("861d"),i=n("c6b6"),a=n("b622"),o=a("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},"4de4":function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").filter,a=n("1dde"),o=n("ae40"),s=a("filter"),l=o("filter");r({target:"Array",proto:!0,forced:!s||!l},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},5530:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("a4d3"),n("4de4"),n("4160"),n("e439"),n("dbb4"),n("b64b"),n("159b");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},"5a34":function(e,t,n){var r=n("44e7");e.exports=function(e){if(r(e))throw TypeError("The method doesn't accept regular expressions");return e}},"92d0":function(e,t,n){"use strict";var r=n("dca8"),i=n.n(r);i.a},a623:function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").every,a=n("a640"),o=n("ae40"),s=a("every"),l=o("every");r({target:"Array",proto:!0,forced:!s||!l},{every:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},a640:function(e,t,n){"use strict";var r=n("d039");e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){throw 1},1)}))}},ab13:function(e,t,n){var r=n("b622"),i=r("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[i]=!1,"/./"[e](t)}catch(r){}}return!1}},b64b:function(e,t,n){var r=n("23e7"),i=n("7b0b"),a=n("df75"),o=n("d039"),s=o((function(){a(1)}));r({target:"Object",stat:!0,forced:s},{keys:function(e){return a(i(e))}})},d81d:function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").map,a=n("1dde"),o=n("ae40"),s=a("map"),l=o("map");r({target:"Array",proto:!0,forced:!s||!l},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},dbb4:function(e,t,n){var r=n("23e7"),i=n("83ab"),a=n("56ef"),o=n("fc6a"),s=n("06cf"),l=n("8418");r({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){var t,n,r=o(e),i=s.f,u=a(r),c={},d=0;while(u.length>d)n=i(r,t=u[d++]),void 0!==n&&l(c,t,n);return c}})},dca8:function(e,t,n){},e439:function(e,t,n){var r=n("23e7"),i=n("d039"),a=n("fc6a"),o=n("06cf").f,s=n("83ab"),l=i((function(){o(1)})),u=!s||l;r({target:"Object",stat:!0,forced:u,sham:!s},{getOwnPropertyDescriptor:function(e,t){return o(a(e),t)}})},fb84:function(e,t,n){"use strict";var r=n("40a8"),i=n.n(r);i.a}}]);
//# sourceMappingURL=edit-product.aec14783.js.map